var wysibb=wysibb||{};
wysibb.helpers={bbReplace:function(b,g,p){for(;b.match(g);)b=b.replace(g,p);return b},wbbStringFormat:function(b,g){return b.replace(/\{([\w\.]*)\}/g,function(b,s){var v=s.split("."),w=g[v.shift()];$.each(v,function(){w=w[this]});return null===w||void 0===w?"":w})},checkBBtoHTML:function(b){var g,p,s=b.bbToHTML;if(!s||s.isEmpty())s={},g=b.bbOpen+"(.*?)"+b.bbClose,p=b.htmlOpen+"$1"+b.htmlClose,s[g]=p,b.bbToHTML=s},replaceBBtoHTML:function(b,g){var p,s,v;for(v in g)g.hasOwnProperty(v)&&(p=g[v],v=v.replace(/\*\]/g,
"\\*]").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\\\[\\\[/g,"[").replace(/\\\]\\\]/g,"]"),v=v.replace("(.*?)","([\\s\\S]*?)"),s=RegExp(v,"gmi"),b=wysibb.helpers.bbReplace(b,s,p));return b},removeBreaks:function(b){var g;g=/(\r\n|\n|\r)/gm;b=b.replace(g,"<1br />");g=/<1br \/>/gi;b=b.replace(g," ");g=/\s+/g;return b=b.replace(g," ")}};Object.prototype.isEmpty=function(){for(var b in this)if(this.hasOwnProperty(b))return!1;return!0};wysibb=wysibb||{};
wysibb.render=function(b){var g,p,s=wysibb.options,v=s.smileList.length,w,M=s.allButtons,r,N=function(b,g){var r;""!==g.bbOpen&&""!==g.bbClose&&(wysibb.helpers.checkBBtoHTML(g),r=g.bbToHTML,b=wysibb.helpers.replaceBBtoHTML(b,r));return b},b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;");for(r=0;r<v;r+=1)w=s.smileList[r],w.img=wysibb.helpers.wbbStringFormat(w.img,s),g=w.bbcode,w&&w.img&&(g=g.replace(/([^a-z0-9])/gi,"\\$1"),g=RegExp(g,"mg"),b=b.replace(g,w.img));for(p in M)if(M.hasOwnProperty(p))if(g=s.allButtons[p],
!g.type||"select"!==g.type)b=N(b,g);else{v=g.options.split(",");w=v.length;for(r=0;r<w;r+=1)g=v[r],g=s.selectOptions[g],b=N(b,g)}return b};wysibb=wysibb||{};
(function(b){b.wysibb=function(g,p){function s(a,d,c){this.updateUI=function(){a.queryState(c)?b(d).addClass("on"):b(d).removeClass("on")};b(d).attr("unselectable","on");b(d).find("*").attr("unselectable","on");b(d).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});b(d).live("click",function(){a.execute(c);r();J()})}function v(a,d,c){var h=[],f=[];this.updateUI=function(){b(d).find(".sel-value").html(c.title);b(a).each(function(a,c){var f=h[c.option].opt;if(!0===h[c.option].cmd.queryState(f)&&
!f.isDefault)return b(d).find(".sel-value").html(f.title),!1})};b(d).attr("unselectable","on");b(d).find("*").attr("unselectable","on");b(d).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});if(0<a.length)for(var k=0;k<a.length;k++){var g=a[k].opt,j=a[k].el,i=a[k].option,l=g.command.replace(/new\s+(\w+)(.*)/i,"$1"),m=g.command.replace(/new\s+\w+\((.*)\)/i,"$1").replace(/\"/g,"").split(","),o={};K[l].apply(o,m);h[i]={cmd:o,opt:g};f[f.length]=g;b(j).attr("optname",i).live("click",
function(){var a=b(this).attr("optname");h[a].cmd.execute(h[a].opt,f);b(d).find(".sel-value").html(h[a].opt.title)})}}function w(a,d,c){var h=[];this.updateUI=function(){b(d).find(".val-line").css("background-color","#000000");b(a).each(function(a,c){if(!0===h[c].cmd.queryState(h[c].opt))return b(d).find(".val-line").css("background-color",c),!1})};b(d).attr("unselectable","on");b(d).find("*").attr("unselectable","on");b(d).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});if(0<
a.length){for(var f=0;f<a.length;f++){var k=a[f],g=m(c.command,{color:k}),j=g.replace(/new\s+(\w+)(.*)/i,"$1"),g=g.replace(/new\s+\w+\((.*)\)/i,"$1").replace(/\"/g,"").split(","),i={};K[j].apply(i,g);h[k]={cmd:i,opt:c}}b(d).find("div.scolor").live("click",function(){var a=b(this).attr("title");h[a].cmd.execute(h[a].opt);r()});b(d).find("div.nocolor").live("click",function(){h["#000000"].cmd.execute(h["#000000"].opt);r()})}}function M(a,d){var c=new K.TableCommand;this.updateUI=function(){c.queryState(d)?
b(a).addClass("on"):b(a).removeClass("on")};b(a).attr("unselectable","on");b(a).find("*").attr("unselectable","on");b(a).live("mousedown",function(a){a.preventDefault&&a.preventDefault()});b(a).find(".tbl-sel").live("click",function(){var a=b(this).attr("title").split(",");l.focus();c.execute(a[0],a[1]);r();J()})}function r(){b(I).each(function(a,b){b.updateUI()})}function N(a){var b=window.prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:",
"http://");null!==b&&a.callback({url:b})}function Y(a){var d=a.url?a.url:m("{themePrefix}{themeName}/img/imgpreview.png",i),c=a.url?"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",h=m(a.uploader.uploadurl,i),f=b(u(m('<div><ul class="wbb-imagemenu"><li  class="{op.url.class}" onClick="$(this).parent().find(\'li.active\').removeClass(\'active\');$(this).addClass(\'active\').parent().next(\'.url-image\').show().next(\'.local-img\').hide();"><span>\u0412\u0432\u0435\u0441\u0442\u0438 URL</span></li><li class="{op.upload.class}" style="{op.upload.listyle}" onClick="$(this).parent().find(\'li.active\').removeClass(\'active\');$(this).addClass(\'active\').parent().next(\'.url-image\').hide().next(\'.local-img\').show()"><span>\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u0430\u0439\u043b</span></li> </ul> <div class="url-image" style="{op.url.style}"> <table class="veditor-addlink-window" cellpadding="0" cellspacing="10"> <tbody> <tr> <td class="center"> <table cellpadding="0" cellspacing="0" class="imgpreview"> <tbody> <tr> <td> <img id="imgpreview" src="{imgpreview}" /> </td> </tr> </tbody> </table> </td> <td> <label class="tbl-label" style="display:block">URL \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f</label> <input type="text" id="veditor_img" style="width:300px" value="{img}" /> <div> <button id="save1" class="wbb-okbtn" style="padding:3px 15px;margin-top:15px;">{saveButton}</button> </div> </td> </tr> </tbody> </table> </div>  <div style="{op.upload.style}" class="local-img"> <form id="fupform" class="upload" action="{uploadurl}" method="post" enctype="multipart/form-data" target="fupload"><input type="hidden" name="iframe" value="1"/><input type="hidden" name="idarea" value="{idarea}" /><div class="p">\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u044e\u0434\u0430</div> <div class="p2">\u0438\u043b\u0438</div> <div class="fileupload"> <input id="fileupl" class="file" type="file" name="img" /><span  id="nicebtn" class="wbb-okbtn">\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438</span> </div> </form> </div><iframe id="fupload" name="fupload" src="about:blank" frameborder="0" style="width:0px;height:0px;display:none"></iframe></div>',
{saveButton:c,imgpreview:d,img:a.url,uploadurl:h,op:{url:{"class":1==a.uploader.defaultType||!a.uploader.enable?"active":"",style:1==a.uploader.defaultType||!a.uploader.enable?"":"display:none"},upload:{"class":2==a.uploader.defaultType&&a.uploader.enable?"active":"",listyle:!a.uploader.enable?"display:none":"",style:2==a.uploader.defaultType&&a.uploader.enable?"":"display:none"}},idarea:O}),document));W("\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",
f);f.find("#save1").click(function(){l.focus();f.find("span.inperr").remove();var d=f.find("#veditor_img");d.val().match(/https*\:\/\//g)?(a.callback({img:d.val()}),b("#wbbModalWindow").hide(),b(document).unbind("mousedown"),f.find("#veditor_img").unbind("keyup change")):d.after('<br/><span style="color:red;font-size:0.9em">\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0430\u0434\u0440\u0435\u0441\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f.</span>')});
if("undefined"==typeof window.FileReader)b.log("Drag&Drop \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c!"),f.find(".local-img .p, .local-img .p2").hide(),f.find(".fileupload").css("margin-top","30px");else{var g=f.find(".local-img");g[0].ondragover=function(){g.addClass("hover");return!1};g[0].ondragleave=function(){g.removeClass("hover");return!1};g[0].ondrop=function(b){b.preventDefault();
g.removeClass("hover");(b=b.dataTransfer.files[0])?b.name.match(/\.(jpg|png|jpeg|gif)$/)?(Z(h,b,a,function(){g.addClass("droperr");f.find(".local-img .err").remove();f.find(".local-img").append('<span class="err">\u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430.</span>')}),f.find(".local-img").html(m('<div class="loader"><img src="{themePrefix}/{themeName}/img/loader.gif" /><br/>\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430</div>',
i))):(f.find(".local-img .err").remove(),f.find(".local-img").append('<span class="err">\u041c\u043e\u0436\u043d\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c jpg,png,gif.</span>'),g.addClass("droperr")):(g.addClass("droperr"),f.find(".local-img .err").remove(),f.find(".local-img").append('<span class="err">\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d.</span>'))}}b.browser.msie&&
(f.find("#nicebtn").hide(),f.find("#fileupl").css("opacity","1"));f.find("#fileupl").bind("change",function(){b("#fupform").submit()});f.find("form.upload").bind("submit",function(){f.find(".local-img").hide().after(m('<div class="local-img"><div class="loader"><img src="{themePrefix}/{themeName}/img/loader.gif" /><br/>\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430</div></div>',i));return true});f.find("#veditor_img").bind("keyup change",function(){b("#imgpreview").attr("src",
b(this).val())}).focus()}function C(a,b){var c=j.getTextWithInfo(),h=a.bbOpen?a.bbOpen:"",f=a.bbClose?a.bbClose:"",k=a.bbcode?a.bbcode:"";!0===a.skipSelectRange&&(c.text="");var i="",i=""!=k?k:m(h+c.text+f,b);g.value=g.value.substr(0,c.start)+i+g.value.substr(c.end,g.value.length-c.end);"url"!=a.bbName&&("img"!=a.bbName&&(!c||0==c.length))&&j.setRange(c.start+i.length-f.length)}function y(a){for(var b=j.getTextWithInfo(),b=g.value.substr(0,b.start),c=RegExp("\\[(.*?)\\]","mgi"),h=0,f;f=c.exec(b);){f=
f[1];f=f.replace(/=.*/,"");var k="/"==f.substr(0,1);f.replace("/","").toLowerCase()==a.toLowerCase()&&(k?h--:h++)}return 0<h}function R(a,d,c){return q?y(d):b(c).is(a)||0<b(c).parents(a).size()}function E(a,d){d||(d=j.getRange());for(var c=j.getNodeByRange(d);c&&"BODY"!=c.tagName;){if(b(c).is(a))return c;if(c)c=c.parentNode;else break}return null}function P(a){var b=j.getTextWithInfo(),c=g.value.substr(0,b.start),h=g.value.substr(b.end,g.value.length-b.end),f=RegExp("^(.*?)\\[\\/"+a+"\\]","i"),c=
c.replace(RegExp("\\["+a+"(?:\\=http.*?)*\\](.*?)$","i"),"$1"),h=h.replace(f,"$1");g.value=c+b.text+h}function Q(a){var d="";X(l);var a=b(a).clone(),c;for(c in i.smileList){var h=i.smileList[c],f=h.bbcode,g=b(h&&h.img?h.img:"");a.find("img").each(function(){b(this).attr("src")==g.attr("src")&&b(this).replaceWith(f)})}for(c=0;c<H.length;c++){var h=i.allButtons[H[c]].htmlToBB,j;for(j in h){var m=h[j];a.find(j).each(function(a,d){var c=m,c=c.replace(/\%(.*?)\%/g,function(a){a=a.substr(1,a.length-2);
a=a.replace("this","el");try{return eval(a)}catch(c){return b(d).html()}});b(d).replaceWith("<span>"+c+"</span>")})}}a.find("*[mustremoved='1']").remove();a.contents().each(function(){if(3===this.nodeType){var a=b(this).text();d+=a}else if(b(this)[0].tagName){if("br"==b(this)[0].tagName.toLowerCase())return d+="\n",!0;d+=Q(this)}});return d}function S(a){return wysibb.render(a)}function aa(a){b(a).find("*").filter(function(){var a=b(this)[0].tagName.toLowerCase();if(-1==b.inArray(a,i.validTags))return b(this).after(this.innerHTML),
!0;var c=this,a=b.map(this.attributes,function(a){return a.name});b.each(a,function(a,d){"href"!=d&&("src"!=d&&"class"!=d)&&b(c).removeAttr(d)});return!1}).remove()}function ba(){var a=[],d=b("a img[alt=':)']"),c=b("a img[alt=';)']");if(0<d.size()&&0<c.size()){var h,f=c.parents();d.parents().each(function(a,b){f.each(function(a,d){if(b==d)return h=b,!1});if(h)return!1});b(h).find("img[alt!='']").each(function(d,c){var f=b(c).attr("title"),h=b(c).attr("alt"),g=c.outerHTML;f&&h&&a.push({title:f,img:g,
bbcode:h})})}5<a.length&&(i.smileList=a)}function ca(){for(var a={},b=[],c=0;c<i.smileList.length;c++){var h=i.smileList[c];h.img=h.img.replace(h.bbcode,"");a[h.bbcode]=h;b.push(h.bbcode)}b.sort(function(a,b){return a.length>b.length?-1:1});h=[];for(c=0;c<b.length;c++)h.push(a[b[c]]);i.smileList=h}function da(a,d){function c(){return b(this).attr("sl")==i?o=!0:0!=b(this).find('*[sl="'+i+'"]').size()?(b(this).contents().filter(c).remove(),!1):o}function h(){return b(this).attr("sl")==i?(o=!1,!0):0!=
b(this).find('*[sl="'+i+'"]').size()?(b(this).contents().filter(h).remove(),!1):o}b.log("is is text, multievents");var f=j.getNode(),g=j.getHTML(),f=b(f),i=Math.floor(1E3*Math.random(0,1E4));j.overrideWithNode(m('<span sl="{rnd}"></span>',{rnd:i}));var n=f.closest(d),q=n.clone(!0),r=n.clone(!0);if(-1==g.indexOf(">")||-1==g.indexOf("</")){var s=t.createTextNode(g);f.parents().each(function(){if(b(this).is(d))return!1;b.log("Parent: "+this.tagName);var a=b(this).clone().empty();a.append(s);s=a.get(0)});
g=3==s.nodeType?s.textContent:s.outerHTML}else f.is(d)||(g=f.clone().empty().append(g).get(0).outerHTML);var o=!1;q.contents().filter(c).remove();o=!0;r.contents().filter(h).remove();n.before(q).after(r).replaceWith(g);X(l)}function X(a){function d(){if(!b(this).is("span,font"))return!1;if(0==b(this).html().length||0<b(this).children().size()&&(b(this).children().filter(d).remove(),0==b(this).html().length&&"BODY"!=this.tagName))return!0}b(a).children().filter(d).remove()}function u(a,d){d||(d=t);
if(-1!=a.indexOf("<")){var c=d.createElement("SPAN");c.innerHTML=a;return b(c).children().unwrap().get(0)}return c=d.createTextNode(a)}function T(a,d,c){c=b(c.target).closest(a);c.attr("wbshow")?(c.attr("title",c.attr("titleoff")).removeAttr("titleoff"),c.removeClass("on").removeAttr("wbshow"),c.find(d).hide(),b(document).die("mousedown",F),B.die("mousedown",F)):(c.attr("titleoff",c.attr("title")).removeAttr("title"),c.parent().find(a).removeClass("on").find(d).hide(),c.addClass("on").attr("wbshow",
"1"),c.find(d).show(),b(document).live("mousedown",function(b){F(a,d,b)}),B.live("mousedown",function(b){F(a,d,b)}))}function F(a,d,c){0==b(c.target).parents(a).size()&&(b(window.parent.document.body).find(a).removeClass("on").find(d).hide(),b(document).die("mousedown",F),B.die("mousedown",F))}function J(){!q&&(l&&l.lastChild&&"br"!=l.lastChild.nodeName.toLowerCase())&&B.append("<br/>")}function ea(a){if("#"===a.substr(0,1))return a;if(-1==a.indexOf("rgb"))return a=parseInt(a),"#"+((a&255)<<16|a&
65280|(a&16711680)>>>16).toString(16);var b=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a);if(b){var a=parseInt(b[2]),c=parseInt(b[3]),b=parseInt(b[4]);if(0==a&&0==c&&0==b)return"#000000";a=(b|c<<8|a<<16).toString(16);6>a.length&&(a="000000"+a,a=a.substr(a.length-6,6));return"#"+a}}function Z(a,d,c,g){var f=new XMLHttpRequest;f.open("POST",a);f.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){b.log("Post image: OK");var a=b.parseJSON(this.responseText);a&&1==a.status?(b("#wbbModalWindow").hide(),
c.callback({img:a.image_link,thumb:a.thumb_link}),r()):g.call()}else b.log("Post ERROR"),g.call()};if(b.support.fileSending)b.log("Use formData"),a=new FormData,a.append("img",d),a.append("maxwidth",c.maxwidth),a.append("maxheight",c.maxheight),f.send(a);else if(b.support.fileReading&&f.sendAsBinary){b.log("Use custom post");f.setRequestHeader("Content-Type","multipart/form-data, boundary=xxxxxxxxx");f.setRequestHeader("Cache-Control","no-cache");f.setRequestHeader("Content-Length",d.size);var a=
"--xxxxxxxxx\r\n",k=unescape(encodeURIComponent(d.name)),a=a+("Content-Disposition: form-data; name='img'; filename='"+k+"'\r\n")+"Content-Type: application/octet-stream\r\n\r\n"+((d.getAsBinary?d.getAsBinary():d.readAsBinary())+"\r\n");f.sendAsBinary(a+"--xxxxxxxxx--")}}function m(a,b){return wysibb.helpers.wbbStringFormat(a,b)}function W(a,d){var c=b("#wbbModalWindow");0==c.size()&&(c=b(m('<div id="wbbModalWindow" style="display:none"><div class="modal-title"></div><div class="modal-info"></div><div class="modal-close"><button id="wbbCloseModal" class="wbb-redbtn" style="font-size:0.9em;width:120px;margin:5px auto">\u0417\u0430\u043a\u0440\u044b\u0442\u044c</button></div></div>')),
c.find("#wbbCloseModal").click(function(){c.hide();b(document).unbind("mousedown",U)}),b(document.body).append(c));c.find(".modal-title").html(a);c.find(".modal-info").html(d);c.css("margin-top",-1*(c.outerHeight()/2)+"px");c.css("margin-left",-1*(c.outerWidth()/2)+"px");c.css("visibility","visible").css("display","block");b(document).bind("mousedown",U)}function U(a){0==b(a.target).parents("#wbbModalWindow").size()&&(b("#wbbModalWindow").hide(),b(document).unbind("mousedown",U))}var i=wysibb.options,
V;p&&p.preset&&(b.log("Load preset: "+p.preset),b.extend(!0,i,presets[p.preset]||{}));p&&"undefined"!=typeof p.smileList&&(i.smileList=[]);b.extend(!0,i,p);b.extend(b.support,{fileSelecting:null!=window.File&&null!=window.FileList,fileReading:null!=window.FileReader,fileSending:null!=window.FormData});i.themePrefix||b("script").each(function(a,d){var c=b(d).get(0).src.match(/(.*)jquery\.wysibb(\.min)?\.js.*$/);if(c!==null)i.themePrefix=c[1]});V=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||
navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||
navigator.vendor||window.opera).substr(0,4))?!0:!1;-1!=navigator.userAgent.toLowerCase().indexOf("msie 6")&&navigator.userAgent.toLowerCase().indexOf("msie 7");navigator.userAgent.toLowerCase().indexOf("msie 7");var q,I,j,H;b.log("Init WysiBB");var n=b(g);n.data("wbb",this);var O=n.attr("id");O||(O="id"+Math.floor(1E3*Math.random(0,1E4)),n.attr("id",O));var D,L,G,l,t,B;q=i.bbmode;I=[];H=["wbbConvertation"];var K={NativeCommand:function(a,b){b||(b=null);this.getCommandName=function(){return a};this.getCommandParam=
function(){return b};this.execute=function(c){if(q){var h=c.bbName;g.focus();y(h)?P(h):C(c,null)}else{l.focus();t.execCommand(a,false,b)}};this.queryState=function(c){c=c.bbName;if(b){c=t.queryCommandValue(a)+"";c=c.replace(/\'/g,"");a=="foreColor"&&(c=ea(c));return c==b}return q?y(c):t.queryCommandState(a)}},CustomCommand:function(){this.execute=function(a,d){var c=a.rootNode;if(q){g.focus();c=a.bbName;y(c)?P(c):C(a,null)}else{l.focus();if(c=E(c)){var h=b(c);if(h.is("span,font")){h=j.getHTML();if(h==
""){var f=j.getNode(),c=u("<span>\ufeff</span>");b(f).after(c);j.setSelection(null,c,0,0)}else da(c,a.rootNode)}else{b.log("it is block, remove all");if(a.contentSelector){var k=a.contentSelector,k=k.replace(/rootNode/g,"this").replace(/\$/g,"jQuery");h.each(function(){b(this).replaceWith(eval(k))})}}}else{h=j.getHTML();if(h==""){b.log("open empty tag");c=u(m("{htmlOpen}\ufeff{htmlClose}",{htmlOpen:a.htmlOpen,htmlClose:a.htmlClose}));b(c).attr("wbb","true");f=j.getNode();b(c).is("span,font")&&b(f).is("span,font")?
b(f).after(c):j.overrideWithNode(c);b(c).children().size()==0&&j.setSelection(null,c,0,0)}else{f=j.getNode();for(c=false;f&&f.innerHTML==h&&b(f).is("span,font");){h=f.outerHTML;c=f;f=f.parentNode}f=t.createElement("SPAN");f.innerHTML=h;if(d&&d.length>0)for(h=0;h<d.length;h++){var i=d[h];if(i){k=i.contentSelector||"jQuery(this).contents()";k=k.replace(/rootNode/g,"this");b(f).find(i.rootNode).each(function(){b(this).replaceWith(eval(k))})}}else if(a.contentSelector){k=a.contentSelector||"jQuery(this).contents()";
k=k.replace(/rootNode/g,"this");b(f).find(a.rootNode).each(function(){b(this).replaceWith(eval(k))})}h=f.innerHTML;h=u(m("{htmlOpen}{txt}{htmlClose}",{htmlOpen:a.htmlOpen,htmlClose:a.htmlClose,txt:h}));c?b(c).replaceWith(h):j.overrideWithNode(h,null);b(t).attr("wbb","true");j.setSelection(null,h,0,0)}}}};this.queryState=function(a){return R(a.rootNode,a.bbName,j.getNode())}},linkCommand:function(){this.execute=function(a){if(q){g.focus();var d=a.bbName;if(y(d))P(d);else{d=window.prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441 \u0441\u0441\u044b\u043b\u043a\u0438:",
"http://");d!==null&&d!=""&&C(a,{href:d})}}else{l.focus();var d=(a=E("a"))?"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443":"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443",c=a?"":"display:none",h=a?b(a).text():j.getText();j.saveRange();var f=b(m('<table class="veditor-addlink-window" cellpadding="0" cellspacing="10"><tr><td class="right"><label class="tbl-label">\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u043c\u044b\u0439 \u0442\u0435\u043a\u0441\u0442</label></td><td><input type="text" id="veditor_atitle" style="width:300px" value="{atext}" /></td></tr><tr><td class="right"><label class="tbl-label">URL \u0441\u0441\u044b\u043b\u043a\u0438</label></td><td><input type="text" style="width:300px" id="veditor_ahref" value="{ahref}" placeholder="http://"  /></td></tr><tr><td></td><td><div class=""><button class="wbb-okbtn" style="padding:3px 15px;float:left;margin-right:15px;"  unselectable="on">{saveButton}</button><button class="wbb-redbtn" style="padding:3px 15px;float:left;{removeStyle}" unselectable="on">\u0423\u0431\u0440\u0430\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443</button></div></td></tr></table>',
{saveButton:d,removeStyle:c,atext:h,ahref:b(a).attr("href")}));f.find("button.wbb-okbtn").click(function(){var a=f.find("#veditor_atitle"),c=f.find("#veditor_ahref");f.find("span.inperr").remove();if(a.val()==""){a.after('<span class="inperr">\u0422\u0435\u043a\u0441\u0442 \u0441\u0441\u044b\u043b\u043a\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c.</span>');a.focus()}else if(c.val().match(/https*\:\/\//g)){var d=t.createElement("A");
d.setAttribute("href",c.val());d.innerHTML=a.val();j.overrideWithNode(d,j.getSavedRange(),"a");b(document).unbind("mousedown");f.find("#veditor_ahref").unbind("keyup change");b("#wbbModalWindow").hide();l.focus()}else{c.after('<span class="inperr">\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0441\u0441\u044b\u043b\u043a\u0438.<br/> <span style="color:#666">\u041f\u0440\u0438\u043c\u0435\u0440: http://www.wysibb.com</span></span>');
c.focus()}});f.find("button.wbb-redbtn").click(function(){var a=j.getNodeByRange(j.getSavedRange());j.overrideWithNode(b(a).html(),j.getSavedRange(),"a");b("#wbbModalWindow").hide();l.focus()});W("\u0412\u0441\u0442\u0430\u0432\u043a\u0430 \u0441\u0441\u044b\u043b\u043a\u0438",f);f.find("#veditor_ahref").bind("keyup change",function(){(b(this).val()==""||(b(this).val().indexOf(b("#veditor_atitle").val())!=-1||b("#veditor_atitle").val().indexOf(b(this).val())!=-1)&&b(this).val().length>b("#veditor_atitle").val().length)&&
b("#veditor_atitle").val(b(this).val())}).focus()}};this.queryState=function(a){return R("a",a.bbName,j.getNode())}},imgCommand:function(a){this.execute=function(d){if(q){g.focus();var c=d.bbName;if(y(c))P(c);else{b.isFunction(a)||(a=N);c=function(a){C(d,{src:a.url})};a({callback:c})}}else{l.focus();var h=E("img");j.saveRange();b.isFunction(a)||(a=Y);c=function(a){a=a.thumb&&d.uploader.useThumb?u(m('<a href="{img}"><img src="{thumb}" /></a>',a),t):u(m('<img src="{img}" />',a),t);j.overrideWithNode(a,
j.getSavedRange())};a({callback:c,url:b(h).attr("src"),uploader:d.uploader})}};this.queryState=function(){return q?y("img"):false}},TableCommand:function(){this.execute=function(a,d){if(q){for(var c="[table]\n",h=1;h<=a;h++){for(var c=c+" [tr]\n",f=1;f<=d;f++)c=c+"  [td][/td]\n";c=c+" [/tr]\n"}c=c+"[/table]";h=j.getTextWithInfo();g.value=g.value.substr(0,h.start)+c+g.value.substr(h.end,g.value.length-h.end)}else{c=b(u(m('<table class="wbbtable" cellpadding="0" cellspacing="5"></table>')));for(h=1;h<=
a;h++)for(var i=b("<tr></tr>").appendTo(c),f=1;f<=d;f++)b("<td>\ufeff</td>").appendTo(i);j.overrideWithNode(c.get(0),null)}};this.queryState=function(){return q?y("table"):E("table")}},smileCommand:function(){this.execute=function(a){if(q){g.focus();C(a,null)}else{l.focus();j.overrideWithNode(m(a.img,i))}};this.queryState=function(){return false}},justifyCommand:function(){this.execute=function(a){if(q){g.focus();C(a,null)}else{l.focus();var d=E(a.rootNode);if(d){b(d).replaceWith(b(d).html());b(d).replaceWith(b(d).html())}else{var d=
E(".wbb-left,.wbb-center,.wbb-right"),c=j.getHTML();if(d){a=u(m("{htmlOpen}{txt}{htmlClose}",{htmlOpen:a.htmlOpen,htmlClose:a.htmlClose,txt:b(d).html()}));b(d).replaceWith(a)}else{a=u(m("{htmlOpen}{txt}\ufeff{htmlClose}",{htmlOpen:a.htmlOpen,htmlClose:a.htmlClose,txt:c}));j.overrideWithNode(a)}j.setSelection(null,a,0,0)}}};this.queryState=function(a){return R(a.rootNode,a.bbName,j.getNode())}}};this.getBBCode=function(){return q?n.val():Q(l)};this.pasteEvent=function(a,d){b.log(d)};this.insertImgWithThumb=
function(a,d){b("#wbbModalWindow").hide();if(q){var c=j.getTextWithInfo();g.value=g.value.substr(0,c.start)+bbstring+g.value.substr(c.end,g.value.length-c.end)}else{c=d&&i.allButtons.img.uploader.useThumb?u(m('<a href="{img}"><img src="{thumb}" /></a>',{img:a,thumb:d}),t):u(m('<img src="{img}" />',{img:a,thumb:d}),t);j.overrideWithNode(c,j.getSavedRange())}r()};i.smileAutoDetect&&ba();(function(){n.css("border","0").css("outline","none");n.after(m('<link rel="stylesheet" type="text/css" media="all" href="{themePrefix}/{themeName}/theme.css" />',
i));n.wrap('<div class="wysibb"></div>');var a=i.buttons.split(",");if(a&&a.length>0){b.extend(true,i.allButtons,i.extraButtons);delete i.extraButtons;b.log("Create toolbar. Active buttons: "+a.length);for(var d=n.before('<div class="wysibb-toolbar"></div>').prev(),c=0;c<a.length;c++){var h=b.trim(a[c].toLowerCase());if(h=="|")d.append('<div class="wysibb-toolbar-vert"></div>');else if(h=="-")d.append('<div class="wysibb-toolbar-linebreak"></div>');else{var f=i.allButtons[h];if(f){var k=f.type;if(k&&
k=="select"){k=b(u(m('<div class="wysibb-toolbar-select" title="{title}"><div class="select-wrap"><span class="sel-value">{title}</span><div class="select-list"></div></div><span class="select-arrow"><span></span></span></div>',f),document));k.find(".select-wrap");k.find(".select-arrow");for(var p=k.find(".select-list").css("display","none"),A=f.options?f.options.split(","):[],y=[],x=0;x<A.length;x++){var z=A[x],o=i.selectOptions[z];if(o){o.html=m(o.htmlOpen+o.title+o.htmlClose);var C=b(u(m('<a href="javascript:void(0)" class="select-row isdefault-{isDefault}">{html}</a>',
o),document));p.append(C);if(!o.isDefault){b.extend(f.htmlToBB,o.htmlToBB);if(!o.bbToHTML){o.bbToHTML={};var F=o.bbOpen.replace(/\s+/,"\\s")+"(.*?)"+o.bbClose.replace(/\s+/,"\\s");o.bbToHTML[F]=o.htmlOpen+"$1"+o.htmlClose}if(!f.bbToHTML)f.bbToHTML={};b.extend(f.bbToHTML,o.bbToHTML)}y.push({opt:o,el:C,option:z})}}i.allButtons[h]=f;f=new v(y,k,f);I.push(f);H.push(h);d.append(k);k.live("click",function(a){T(".wysibb-toolbar-select",".select-list",a)})}else if(k&&k=="colorpicker"){k=b(u(m('<div class="wysibb-toolbar-colorpicker" title="{title}">{buttonHTML}<span class="cpicker-dropdown"></span><div class="clist"><div class="nocolor" title="\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d">\u0410\u0432\u0442\u043e</div></div>',
f),document));p=k.find("div.clist");A=f.colorList?f.colorList.split(","):[];for(x=0;x<A.length;x++){z=b.trim(A[x])||"";A[x]=z;z=="-"?p.append('<span class="pl"></span>'):p.append(m('<div class="scolor" style="background:{color}" title="{color}"></div>',{color:z}))}f=new w(A,k,f);I.push(f);H.push(h);d.append(k);k.live("click",function(a){T(".wysibb-toolbar-colorpicker",".clist",a)})}else if(k&&k=="table"){k=b(u(m('<div class="wysibb-toolbar-table" title="{title}">{buttonHTML}<span class="cpicker-dropdown"></span><div class="clist"></div>',
f),document));p=k.find("div.clist");z=f.rows||10;A=f.cols||10;y=z*A;p.css("width",A*f.tdwidth+2+"px").css("height",z*f.tdwidth+2+"px");for(x=1;x<=A;x++)for(o=1;o<=z;o++)p.append(m('<div class="tbl-sel" style="width:{width}px;height:{height}px;z-index:{zindex}" title="{row},{col}"></div>',{width:x*f.tdwidth,height:o*f.tdwidth,zindex:--y,row:o,col:x}));f=new M(k,f);I.push(f);H.push(h);d.append(k);k.live("click",function(a){T(".wysibb-toolbar-table",".clist",a)})}else{f.buttonHTML=m(f.buttonHTML,i);
k=b(u(m('<div class="wysibb-toolbar-btn" title="{title}" unselectable="on">{buttonHTML}</div>',f),document));d.append(k);x=f.command.replace(/new\s+(\w+)(.*)/i,"$1");z=f.command.replace(/new\s+\w+\((.*)\)/i,"$1").replace(/\"/g,"").split(",");p={};K[x].apply(p,z);f=new s(p,k,f);I.push(f);H.push(h)}}}}d.append('<div class="wysibb-toolbar-btn btnModeSwitch" title="\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c BBcode" unselectable="on"><span class="ve-tlb-bbcode" unselectable="on"></span></div>');
d.find(".btnModeSwitch").click(function(){if(q){q=false;B.html(S(n.val()));D.show();n.hide().val("");b(this).removeClass("on")}else{q=true;l&&(l.lastChild&&l.lastChild.nodeName.toLowerCase()=="br")&&b(l.lastChild).remove();n.val(Q(l));D.hide();n.show();b(this).addClass("on")}})}if(i.smileList&&i.smileList.length>0){a=n.after('<div class="wysibb-toolbar wysibb-bottom-toolbar"></div>').next();for(c=0;c<i.smileList.length;c++){d=i.smileList[c];d.img=m(d.img,i);k=b(u(m('<div class="wysibb-toolbar-btn" title="{title}" unselectable="on">{img}</div>',
d),document));a.append(k);f=new s(new K.smileCommand,k,d)}a.append('<div class="wysibb-powered" title="\u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440 BBcode" unselectable="on"><a href="http://www.wysibb.com" target="_blank">WysiBB</a></div>')}ca();n.wrap('<div class="wysibb-text"></div>');if(i.onlyBBmode!==true){c=n.width();k=n.outerHeight();n.css("width",c-12+"px").css("margin","0").css("font-size","14px").css("padding","0").css("max-width","100%");D=b(m('<iframe src="about:blank" class="wysibb-text-iframe" frameborder="0" style="margin:0;width:100%;height:{height}px;max-width:100%"></iframe>',
{width:c,height:k}));D.bind("load",function(){L=D.get(0);G=L.contentWindow;t=L.contentWindow.document;l=L.contentWindow.document.body;B=b(l);var a=t.getElementsByTagName("head")[0];b(document.getElementsByTagName("head")[0]).find("link[rel='stylesheet']").each(function(c,d){b(a).append(b(d).clone())});b(document.body).find("link[rel='stylesheet']").each(function(c,d){b(a).append(b(d).clone())});B.addClass("wysibb-body").addClass(i.bodyClass);if("contentEditable"in l&&!V){l.contentEditable=true;try{t.execCommand("StyleWithCSS",
false,false)}catch(c){}}else q=i.onlyBBmode=true;if(n.val()!=""){B.html(S(n.val()));n.val("");J()}V?b(t).live("click",r):b(t).live("mouseup",r);b(t).live("keyup",function(){r();J()});i.tabInsert==true&&b(t).live("keydown",function(a){if(a.which==9){a.preventDefault&&a.preventDefault();j.overrideWithNode('<span class="tab">\ufeff</span>',null)}});b(t).live("keydown",function(a){if(a.which==86&&(a.ctrlKey==true||a.metaKey==true)||a.which==45&&(a.shiftKey==true||a.metaKey==true)){j.saveRange();b(l).removeAttr("contentEditable");
var c=u("<div></div>",t);b(c).attr("contenteditable","true").attr("class","paste").appendTo(l).on("paste",function(){setTimeout(function(){b(c).text();aa(c);var a=b(c).html();b(c).remove();b(l).attr("contentEditable","true");l.focus();j.overrideWithNode("<span>"+a+"</span>",j.getSavedRange())},1)}).focus()}});if(i.watchTxtArea===true){b(document).live("click",function(a){if(!q&&b(a.target).parents(".wysibb").size()==0&&n.data("prevVal")!=n.val()){b.log("txtArea has changed");j.overrideWithNode(S(n.val()),
null,null,true,true);n.val("");n.data("prevVal","");J()}});n.data("prevVal",n.val())}B.live("keydown",function(a){var c=E("li");if(a.which==13&&!c){a.preventDefault();l.focus();a=j.getNode();(a.tagName=="DIV"||a.tagName=="BODY")&&a.lastChild.nodeName.toLowerCase()!="br"&&b(a).append("<br/>");a=G.document.createElement("BR");j.overrideWithNode(a,null)}});i.autoResize&&B.live("keydown mouseup",function(){if(i.autoResize){var a=D.contents().height();D.height(a>i.maxheight?i.maxheight:a)}})});n.after(D);
n.hide()}if(q){b(L).hide();b(g).show()}n.live("keyup mouseup",r)})();j=new function(){this.getNode=function(a){if(q){g.focus();return g}var b=null,b=window.getSelection?this.getRange().commonAncestorContainer:this.getRange().parentElement();return b=!a&&b.nodeType===3?b.parentNode:b};this.getNodeByRange=function(a){var d=null,d=window.getSelection?a.commonAncestorContainer:a.parentElement();return d=d.nodeType===3?b(d).parent().get(0):d};this.getText=function(){return q?this.getTextWithInfo().text:
window.getSelection?this.getRange().toString():this.getRange().text};this.getHTML=function(){var a;if(G.getSelection){a=G.getSelection();var b;if(a.getRangeAt)b=a.getRangeAt(0);else{b=t.createRange();b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset)}a=b.cloneContents();b=document.createElement("div");b.appendChild(a);return b.innerHTML}if(t.selection){a=t.selection.createRange();return a.htmlText}return""};this.getRange=function(){if(window.getSelection){l.focus();return G.getSelection().getRangeAt(0)}var a=
G.document.selection.createRange();if(a)return a};this.getTextWithInfo=function(){if("selectionStart"in g&&q){var a=g.selectionEnd-g.selectionStart;return{start:g.selectionStart,end:g.selectionEnd,length:a,text:g.value.substr(g.selectionStart,a)}}if(document.selection&&q){g.focus();var a=document.selection.createRange(),b=g.createTextRange(),c=b.duplicate();c.moveToBookmark(a.getBookmark());b.setEndPoint("EndToStart",c);if(a==null||b==null)return{start:g.value.length,end:g.value.length,length:0,text:""};
c=a.text.replace(/[\r\n]/g,".");b=g.value.replace(/[\r\n]/g,".").indexOf(c,b.text.length);return{start:b,end:b+c.length,length:c.length,text:a.text}}return{start:e.value.length,end:e.value.length,length:0,text:""}};this.setRange=function(a){if(q)if(window.getSelection){g.selectionStart=a;g.selectionEnd=a}else{var b=g.createTextRange();b.collapse(true);b.move("character",a);b.select()}};this.overrideWithNode=function(a,d,c){d||(d=this.getRange());l.focus();var g=window.getSelection?true:false,f=j.get();
this.getNodeByRange(d);typeof a=="string"&&(a=u(a));a=b(a).get(0);if(c)(c=E(c,d))&&b(c).remove();g&&d.deleteContents();if(g){d.insertNode(a);d.setStartAfter(a);d.setEndAfter(a);f.removeAllRanges();f.addRange(d)}else{d.pasteHTML(a.outerHTML);d.collapse();d.select()}r();return a};this.lastRange=null;this.get=function(){return window.getSelection?G.getSelection():G.document.selection};this.saveRange=function(){this.lastRange=window.getSelection?this.getRange().cloneRange():this.getRange()};this.getSavedRange=
function(){return this.lastRange};this.setSelection=function(a,b,c,g){var f=j.get();a||(a=this.getRange());if(window.getSelection){if(c&&g){a.setStart(b,c);a.setEnd(b,g)}else a.selectNodeContents(b);f.removeAllRanges();f.addRange(a)}else if(b){a.moveToElementText(b);if(c>=0&&g>=0){a.moveStart("character",c);a.moveEnd("character",g)}a.select()}}};(function(){b.log("initFormSubmit");n.parents("form").bind("submit",function(){try{if(!q){l&&(l.lastChild&&l.lastChild.nodeName.toLowerCase()=="br")&&b(l.lastChild).remove();
n.val(Q(l))}return true}catch(a){D.after('<div style="color:red;font-siz:10px;padding:10px;">\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 bbcode.</div>"');return false}})})()};b.fn.skipWBB=function(){return b(this).attr("mustremoved","1")};b.log=function(b){"undefined"!=typeof console&&console.log(b)};b.fn.wysibb=function(g){return this.each(function(){new b.wysibb(this,g)})}})(jQuery);