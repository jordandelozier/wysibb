var wysibb=wysibb||{};
wysibb.helpers={bbReplace:function(a,b,f){for(;a.match(b);)a=a.replace(b,f);return a},wbbStringFormat:function(a,b){return a.replace(/\{([\w\.]*)\}/g,function(a,c){var d=c.split("."),e=b[d.shift()];$.each(d,function(){e=e[this]});return null===e||void 0===e?"":e})},checkBBtoHTML:function(a){var b,f,c=a.bbToHTML;if(!c||this.isEmpty(c))c={},b=a.bbOpen+"(.*?)"+a.bbClose,f=a.htmlOpen+"$1"+a.htmlClose,c[b]=f,a.bbToHTML=c},replaceBBtoHTML:function(a,b){var f,c,d;for(d in b)b.hasOwnProperty(d)&&(f=b[d],
d=d.replace(/\*\]/g,"\\*]").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\\\[\\\[/g,"[").replace(/\\\]\\\]/g,"]"),d=d.replace("(.*?)","([\\s\\S]*?)"),c=RegExp(d,"gmi"),a=wysibb.helpers.bbReplace(a,c,f));return a},removeBreaks:function(a){var b;b=/(\r\n|\n|\r)/gm;a=a.replace(b,"<1br />");b=/<1br \/>/gi;a=a.replace(b," ");b=/\s+/g;return a=a.replace(b," ")},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}};wysibb=wysibb||{};
wysibb.render=function(a){var b,f,c=wysibb.options,d=c.smileList.length,e,h=c.allButtons,g,i=function(a,b){var c;""!==b.bbOpen&&""!==b.bbClose&&(wysibb.helpers.checkBBtoHTML(b),c=b.bbToHTML,a=wysibb.helpers.replaceBBtoHTML(a,c));return a},a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");for(g=0;g<d;g+=1)e=c.smileList[g],e.img=wysibb.helpers.wbbStringFormat(e.img,c),b=e.bbcode,e&&e.img&&(b=b.replace(/([^a-z0-9])/gi,"\\$1"),b=RegExp(b,"mg"),a=a.replace(b,e.img));for(f in h)if(h.hasOwnProperty(f))if(b=c.allButtons[f],
!b.type||"select"!==b.type)a=i(a,b);else{d=b.options.split(",");e=d.length;for(g=0;g<e;g+=1)b=d[g],b=c.selectOptions[b],a=i(a,b)}a=$("<div>"+a+"</div>");a.find("ul > br,table > br, tr > br").each(function(a,b){$(b).remove()});return a.html()};